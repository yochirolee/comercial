generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// USUARIO - Autenticaci√≥n del sistema
// ==========================================
model Usuario {
  id               String   @id @default(cuid())
  nombre           String
  apellidos        String
  telefono         String?
  email            String   @unique
  password         String
  activo           Boolean  @default(true)
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  resetTokens      PasswordResetToken[]
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  usuarioId String
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  used      Boolean  @default(false)
  
  createdAt DateTime @default(now())
}

model Empresa {
  id               String   @id @default(cuid())
  nombre           String
  direccion        String?
  telefono         String?
  email            String?
  nit              String?
  representante    String?
  cargoRepresentante String?
  codigoMincex     String?
  logo             String?
  firmaPresidente  String?
  cunoEmpresa      String?
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Cliente {
  id               String   @id @default(cuid())
  nombre           String
  apellidos        String?
  contacto         String?
  nombreCompania   String?
  direccion        String?
  telefono         String?
  email            String?
  nit              String?
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  ofertasCliente        OfertaCliente[]
  ofertasImportadora    OfertaImportadora[]
  facturas              Factura[]
}

model UnidadMedida {
  id               String   @id @default(cuid())
  nombre           String
  abreviatura      String
  usaCajas         Boolean  @default(false)
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  productos        Producto[]
}

model Producto {
  id               String   @id @default(cuid())
  codigo           String?  @unique
  nombre           String
  descripcion      String?
  precioBase       Float
  unidadMedidaId   String
  unidadMedida     UnidadMedida @relation(fields: [unidadMedidaId], references: [id])
  activo           Boolean  @default(true)
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  itemsOfertaGeneral         ItemOfertaGeneral[]
  itemsOfertaCliente         ItemOfertaCliente[]
  itemsOfertaImportadora     ItemOfertaImportadora[]
  itemsFactura               ItemFactura[]
}

model OfertaGeneral {
  id               String   @id @default(cuid())
  numero           String   @unique
  fecha            DateTime @default(now())
  vigenciaHasta    DateTime?
  observaciones    String?
  estado           String   @default("activa")
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  items            ItemOfertaGeneral[]
}

model ItemOfertaGeneral {
  id               String   @id @default(cuid())
  ofertaGeneralId  String
  ofertaGeneral    OfertaGeneral @relation(fields: [ofertaGeneralId], references: [id], onDelete: Cascade)
  productoId       String
  producto         Producto @relation(fields: [productoId], references: [id])
  cantidad         Float    @default(1)
  cantidadCajas    Float?
  cantidadSacos    Float?
  precioUnitario   Float
  pesoXSaco        Float?
  precioXSaco      Float?
  pesoXCaja        Float?
  precioXCaja      Float?
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model OfertaCliente {
  id               String   @id @default(cuid())
  numero           String   @unique
  fecha            DateTime @default(now())
  vigenciaHasta    DateTime?
  clienteId        String
  cliente          Cliente  @relation(fields: [clienteId], references: [id])
  observaciones    String?
  estado           String   @default("pendiente")
  codigoMincex     String?
  puertoEmbarque   String?  @default("NEW ORLEANS, LA")
  origen           String?  @default("ESTADOS UNIDOS")
  moneda           String?  @default("USD")
  terminosPago     String?  @default("PAGO 100% ANTES DEL EMBARQUE")
  incluyeFirmaCliente Boolean @default(false)
  total            Float    @default(0)
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  items            ItemOfertaCliente[]
  ofertasImportadora OfertaImportadora[]
}

model ItemOfertaCliente {
  id               String   @id @default(cuid())
  ofertaClienteId  String
  ofertaCliente    OfertaCliente @relation(fields: [ofertaClienteId], references: [id], onDelete: Cascade)
  productoId       String
  producto         Producto @relation(fields: [productoId], references: [id])
  cantidad         Float
  cantidadCajas    Float?
  cantidadSacos    Float?
  pesoNeto         Float?
  pesoBruto        Float?
  precioUnitario   Float
  subtotal         Float
  pesoXSaco        Float?
  precioXSaco      Float?
  pesoXCaja        Float?
  precioXCaja      Float?
  codigoArancelario String?  // Partida arancelaria (ej: M1500CIULB)
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model OfertaImportadora {
  id               String   @id @default(cuid())
  numero           String   @unique
  fecha            DateTime @default(now())
  vigenciaHasta    DateTime?
  clienteId        String
  cliente          Cliente  @relation(fields: [clienteId], references: [id])
  observaciones    String?
  estado           String   @default("pendiente")
  ofertaClienteId  String?
  ofertaCliente    OfertaCliente? @relation(fields: [ofertaClienteId], references: [id])
  codigoMincex     String?
  puertoEmbarque   String?  @default("NEW ORLEANS, LA")
  origen           String?  @default("ESTADOS UNIDOS")
  moneda           String?  @default("USD")
  terminosPago     String?  @default("PAGO 100% ANTES DEL EMBARQUE")
  incluyeFirmaCliente Boolean @default(true)
  ajustarPrecios   Boolean  @default(true)
  precioAcordado   Float    @default(0)
  flete            Float    @default(0)
  seguro           Float    @default(0)
  tieneSeguro      Boolean  @default(false)
  subtotalProductos Float   @default(0)
  precioCIF        Float    @default(0)
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  items            ItemOfertaImportadora[]
}

model ItemOfertaImportadora {
  id                   String   @id @default(cuid())
  ofertaImportadoraId  String
  ofertaImportadora    OfertaImportadora @relation(fields: [ofertaImportadoraId], references: [id], onDelete: Cascade)
  productoId           String
  producto             Producto @relation(fields: [productoId], references: [id])
  cantidad             Float
  cantidadCajas        Float?
  cantidadSacos        Float?
  pesoNeto             Float?
  pesoBruto            Float?
  precioOriginal       Float
  precioAjustado       Float
  subtotal             Float
  pesoXSaco            Float?
  precioXSaco          Float?
  pesoXCaja            Float?
  precioXCaja          Float?
  codigoArancelario    String?  // Partida arancelaria (ej: M1500CIULB)
  campoExtra1          String?
  campoExtra2          String?
  campoExtra3          String?
  campoExtra4          String?
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Factura {
  id               String   @id @default(cuid())
  numero           String   @unique
  fecha            DateTime @default(now())
  fechaVencimiento DateTime?
  clienteId        String
  cliente          Cliente  @relation(fields: [clienteId], references: [id])
  observaciones    String?
  estado           String   @default("pendiente")
  subtotal         Float    @default(0)
  impuestos        Float    @default(0)
  descuento        Float    @default(0)
  total            Float    @default(0)
  tipoOfertaOrigen String?
  ofertaOrigenId   String?
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  items            ItemFactura[]
}

model ItemFactura {
  id               String   @id @default(cuid())
  facturaId        String
  factura          Factura  @relation(fields: [facturaId], references: [id], onDelete: Cascade)
  productoId       String
  producto         Producto @relation(fields: [productoId], references: [id])
  descripcion      String?
  cantidad         Float
  cantidadCajas    Float?
  pesoNeto         Float?
  pesoBruto        Float?
  precioUnitario   Float
  subtotal         Float
  campoExtra1      String?
  campoExtra2      String?
  campoExtra3      String?
  campoExtra4      String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}
